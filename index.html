<!DOCTYPE html>
<html>
    <header>
        <style>
        .bottomStyle{
            bottom: 0;
            position: fixed;
            /* height: 80px; */
            background-color: lightgray;
            width: 100%;
            padding: 30px 0;
            text-align: center;
        }
        </style>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-TBC7RSCKDL"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-TBC7RSCKDL');
        </script>
    </header>
<body>

    <form action="/">
        <label for="url">Loop Url</label><br>
        <input type="text" id="url" name="url"><br>
        <label for="maxFrame">Max Frame</label><br>
        <input type="text" id="maxFrame" name="maxFrame"><br>
        <label for="stayTime">Time of stay(second):</label><br>
        <input type="text" id="stayTime" name="stayTime" value="Doe"><br><br>
        <input type="submit" value="Loop It!!">
    </form> 
      


    <h1 id='msgTitle'> I ðŸ’– you: </h1>
    <p id='msg'></p>
    <p id='msgTotal'></p>

    <div class='bottomStyle'>
    </div>

<script>

const urlParams = new URLSearchParams(window.location.search);
const TARGET_URL = urlParams.get('url');
const stayTime = urlParams.get('stayTime') || 1
const maxFrame = urlParams.get('maxFrame') || 3
document.getElementById("url").value = TARGET_URL;
document.getElementById("stayTime").value = stayTime;
document.getElementById("maxFrame").value = maxFrame;

const updateAndShowCount = (msg) => {
  document.getElementById("msg").innerHTML = msg;
}
const updateAndShowTotalCount = (msg) => {
  document.getElementById("msgTotal").innerHTML = msg;
}
const updateAndShowTitle = (msg) => {
  document.getElementById("msgTitle").innerHTML = msg;
}

const appendIFrame = () => {
    const iframe = document.createElement("iframe");
    iframe.src = TARGET_URL;
    iframe.width = "100";
    iframe.height = "100";
    document.body.appendChild(iframe); //Append iframe to body element
}

const removeAllIFrame = () => {
    const iframes = document.querySelectorAll("iframe"); //Get all iframes

    for(const item of iframes) {
        console.log('item: ', item)
        item.parentNode.removeChild(item)
    }
}

const sleep = (second = 1) => new Promise((resolve)=>{
    setTimeout(() => {
        return resolve()
    }, second * 1000);
})

window.onload = async function () {
	let count = 0; 
    let total = 0

    updateAndShowTitle(`I love you: ${TARGET_URL}`)

    while (true) {
        await sleep(stayTime)

        if(count >=maxFrame) {
            removeAllIFrame()
            count = 0 
            continue
        };

        appendIFrame()
        count += 1
        total += 1 
        updateAndShowCount(`Current opening ${count} : ${TARGET_URL}`)
        updateAndShowTotalCount(`Total opened ${total} : ${TARGET_URL}`)
    }
}
</script>
</body>
</html>